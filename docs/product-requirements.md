# プロダクト要求定義書 (Product Requirements Document)

## プロダクト概要

### 名称
**TaskCLI** - Git統合型タスク管理CLIツール

### プロダクトコンセプト
- **ターミナル完結**: GUIを開くことなく、ターミナルから離れずにすべてのタスク管理操作を完結
- **Git統合**: タスクとGitブランチが1対1で紐付き、開発フローに自然に溶け込む
- **シンプル・高速**: 最小限の学習コストで使い始められ、即座にレスポンスが返る軽量設計

### プロダクトビジョン
開発者がターミナルから離れることなく、効率的にタスクを管理できるCLIツールを提供する。
タスクの作成からブランチ作成、コミット、マージ、完了までの一連の開発フローを自動化・支援することで、コンテキストスイッチを最小化する。
JiraやAsanaのような重厚なツールではなく、開発者が本当に必要とするシンプルな機能のみを提供し、1分で使い始められる体験を実現する。

### 目的
- ターミナルとGUIの画面切り替えによる集中力の分断を解消する
- タスク管理とコード開発のワークフローを一体化し、作業効率を向上させる
- Git操作とタスクステータスの手動同期作業を自動化する
- 小規模チーム(2-5人)でも軽量に導入できるタスク管理の仕組みを提供する

## ターゲットユーザー

### プライマリーペルソナ: 佐藤健太(28歳、フリーランスエンジニア)
- 開発歴5年、個人で2-3のプロジェクトを並行して進めている
- Vim + ターミナル環境、マウス操作を最小限にしたい
- GitHub Issuesは使っているが、ローカルの作業と連携できず手動でステータスを更新している
- 現在の課題:
  - タスク確認のためにブラウザを開くたびに集中力が途切れる(1日20回以上)
  - どのタスクのためにどのブランチで作業しているか分からなくなることがある
  - タスク完了時の一連の手作業(ステータス更新、PR作成、マージなど)が面倒
- 期待する解決策:
  - ターミナルで完結するタスク管理
  - Gitブランチとタスクの自動連携
  - タスク完了時の自動化
- 1日の典型的なワークフロー:
  - 朝: タスク一覧を確認 → 今日やるタスクを決める → ブランチ作成
  - 日中: コミット → 動作確認 → 追加コミット
  - 夕方: PR作成 → レビュー待ち → マージ → タスク完了

### セカンダリーペルソナ: 田中美咲(35歳、スタートアップのテックリード)
- 開発歴10年、3人の小規模チームをリード
- CLI操作に慣れており、朝会やデイリースクラムでの効率化を求めている
- 現在の課題:
  - チームメンバーが今何をやっているかリアルタイムで知りたい
  - JiraやAsanaは機能が多すぎて、小規模チームには大げさ
  - 朝会でタスク確認に時間がかかりすぎる(毎朝15分)
- 期待する解決策:
  - CLIでさっとチーム全体のタスク状況を確認できる
  - GitHub連携で勝手にタスク進捗が更新される
  - 軽量で導入コストが低い
- 1日の典型的なワークフロー:
  - 朝: チーム全体のタスク状況確認 → 朝会で共有
  - 日中: 自分のタスクも進める
  - 夕方: チームの進捗確認 → 明日の計画

## 成功指標(KPI)

### プライマリーKPI
- **アクティブユーザー数**: リリース後3ヶ月で100人(DAU 30人以上)
  - 測定方法: 匿名の利用統計(オプトイン方式)、GitHub Starの増加数
- **継続率**: 初回使用から1ヶ月後も使い続けているユーザーが60%以上
  - 測定方法: 匿名の利用統計でのコマンド実行頻度(週1回以上を継続と定義)
- **タスク管理時間の削減**: ユーザーがタスク管理にかける時間が50%削減される
  - 測定方法: ユーザーインタビュー(n=10以上)で導入前後の時間を比較

### セカンダリーKPI
- **GitHub Stars**: リリース後6ヶ月で500スター
- **コマンド実行頻度**: 1日あたり平均10回以上のコマンド実行
  - 測定方法: 匿名の利用統計
- **Net Promoter Score (NPS)**: 30以上
  - 測定方法: アプリ内アンケート(四半期に1回)
- **導入率**: 紹介した開発者10人中3人以上が1週間継続使用
  - 測定方法: ベータテスト期間中の追跡調査

## 機能要件

### コア機能(MVP)

#### 1. タスクの基本操作

**ユーザーストーリー**:
開発者として、タスクを作成・一覧表示・完了・削除できるようにしたい。これにより、ターミナルから離れずに基本的なタスク管理ができる。

**受け入れ条件**:
- [ ] `task add "タスク名"` コマンドで新しいタスクを作成できる
- [ ] タスク作成時に一意のIDが自動採番される(1から開始)
- [ ] `task list` コマンドで全タスクを一覧表示できる
- [ ] `task show <id>` コマンドで特定タスクの詳細を表示できる
- [ ] `task done <id>` コマンドでタスクを完了状態にできる
- [ ] `task delete <id>` コマンドでタスクを削除できる
- [ ] 削除時には確認プロンプトが表示される

**優先度**: P0(必須)

#### 2. タスクとGitブランチの自動連携

**ユーザーストーリー**:
開発者として、タスクを開始したときに自動でGitブランチが作成・切り替えされるようにしたい。これにより、タスクとブランチの紐付けを手動で管理する必要がなくなる。

**受け入れ条件**:
- [ ] `task start <id>` コマンドで、`feature/task-<id>-<sanitized-title>` 形式のブランチが自動作成される
- [ ] タスクタイトルはブランチ名に適した形式にサニタイズされる(スペース→ハイフン、特殊文字除去)
- [ ] ブランチ作成後、自動的にそのブランチにチェックアウトされる
- [ ] タスクのステータスが `in_progress` に更新される
- [ ] 既にブランチが存在する場合は、そのブランチにチェックアウトする
- [ ] Gitリポジトリが存在しない場合は、エラーメッセージを表示する

**優先度**: P0(必須)

#### 3. タスクのステータス管理

**ユーザーストーリー**:
開発者として、タスクのステータス(新規、作業中、完了、アーカイブ)を管理できるようにしたい。これにより、タスクの進捗状況を明確に把握できる。

**受け入れ条件**:
- [ ] タスクは以下の4つのステータスを持つ: `open`, `in_progress`, `completed`, `archived`
- [ ] タスク作成時のデフォルトステータスは `open`
- [ ] `task start <id>` でステータスが `in_progress` に変更される
- [ ] `task done <id>` でステータスが `completed` に変更される
- [ ] `task archive <id>` でステータスが `archived` に変更される
- [ ] `task list` でステータスごとに色分け表示される(open: 白, in_progress: 黄, completed: 緑, archived: グレー)

**優先度**: P0(必須)

#### 4. シンプルなタスク一覧表示

**ユーザーストーリー**:
開発者として、タスク一覧を見やすいテーブル形式で表示できるようにしたい。これにより、現在のタスク状況を一目で把握できる。

**受け入れ条件**:
- [ ] `task list` で、ID、ステータス、タイトル、ブランチ名がテーブル形式で表示される
- [ ] デフォルトでは `archived` 以外のタスクが表示される
- [ ] `task list --all` ですべてのタスク(archivedを含む)が表示される
- [ ] `task list --status <status>` で特定ステータスのタスクのみ表示できる
- [ ] テーブルは自動的にターミナル幅に調整される
- [ ] タスクがゼロ件の場合、「タスクがありません」というメッセージが表示される

**優先度**: P0(必須)

#### 5. データの永続化(JSON)

**ユーザーストーリー**:
開発者として、タスクデータがローカルに保存され、ターミナルを閉じても消えないようにしたい。

**受け入れ条件**:
- [ ] タスクデータは `.task/tasks.json` に保存される
- [ ] `.task/` ディレクトリは初回コマンド実行時に自動作成される
- [ ] JSON形式でタスクID、タイトル、ステータス、作成日時、更新日時、ブランチ名が保存される
- [ ] ファイルが破損している場合は、エラーメッセージを表示して安全に終了する
- [ ] `.task/` ディレクトリは `.gitignore` に追加される(オプション)

**優先度**: P0(必須)

#### 6. エラーハンドリングとヘルプ

**ユーザーストーリー**:
開発者として、エラーメッセージが分かりやすく、ヘルプコマンドで使い方を確認できるようにしたい。

**受け入れ条件**:
- [ ] `task --help` で全コマンドの使い方が表示される
- [ ] `task <command> --help` で特定コマンドの使い方が表示される
- [ ] 存在しないタスクIDを指定した場合、「タスクが見つかりません」とエラー表示される
- [ ] Gitリポジトリがない状態で `task start` を実行した場合、適切なエラーメッセージが表示される
- [ ] コマンドの引数が不足している場合、使用例が表示される

**優先度**: P0(必須)

### 将来的な機能(Post-MVP)

#### 7. GitHub Issuesとの連携

開発者として、GitHub IssuesとTaskCLIのタスクを同期できるようにしたい。これにより、リモートとローカルのタスクを一元管理できる。

**受け入れ条件**:
- [ ] `task sync` でローカルタスクとGitHub Issuesを双方向同期できる
- [ ] `task import --github` でGitHub Issuesからタスクをインポートできる
- [ ] Personal Access Tokenで認証する
- [ ] GitHub Issue番号とTaskCLIのタスクIDを紐付けられる

**優先度**: P1(重要)

#### 8. タスク完了時の自動処理

開発者として、タスク完了時にブランチのマージやPR作成を自動化したい。これにより、手作業を削減できる。

**受け入れ条件**:
- [ ] `task done <id> --auto-merge` でmainブランチへの自動マージができる
- [ ] `task done <id> --create-pr` でGitHub PRを自動作成できる
- [ ] 自動マージ前にコンフリクトチェックを行う
- [ ] PR作成時には、タスクタイトルと説明が自動で設定される

**優先度**: P1(重要)

#### 9. タスクの絞り込み・検索

開発者として、タスクをキーワードやステータスで絞り込めるようにしたい。

**受け入れ条件**:
- [ ] `task search <keyword>` でタイトルまたは説明に含まれるタスクを検索できる
- [ ] 検索結果はハイライト表示される

**優先度**: P1(重要)

#### 10. 優先度と期限の管理

開発者として、タスクに優先度と期限を設定できるようにしたい。

**受け入れ条件**:
- [ ] `task add "タスク名" --priority <high|medium|low>` で優先度を設定できる
- [ ] `task add "タスク名" --due <YYYY-MM-DD>` で期限を設定できる
- [ ] `task list --sort priority` で優先度順にソートできる
- [ ] 期限が近いタスクは警告色で表示される

**優先度**: P1(重要)

#### 11. チーム機能

開発者として、チームメンバーのタスク一覧を確認できるようにしたい。

**受け入れ条件**:
- [ ] `task list --team` でチームメンバー全員のタスクを表示できる
- [ ] `task assign <id> @<username>` でタスクを他のメンバーにアサインできる
- [ ] GitHub連携でチームメンバー情報を取得する

**優先度**: P2(できれば)

#### 12. 作業時間の記録

開発者として、タスクにかかった作業時間を記録できるようにしたい。

**受け入れ条件**:
- [ ] `task start <id>` で作業時間の計測が開始される
- [ ] `task done <id>` で作業時間が記録される
- [ ] `task show <id>` で累計作業時間が表示される

**優先度**: P2(できれば)

### CLIインターフェース

```bash
# 基本操作
task add "ユーザー認証機能の実装"
task add "データエクスポート機能" --priority high --due 2025-01-20
task list
task list --status in_progress
task list --all
task show 1
task start 1
task done 1
task delete 1
task archive 1

# 検索・絞り込み(P1以降)
task search "認証"
task list --sort priority

# GitHub連携(P1以降)
task sync
task import --github

# チーム機能(P2以降)
task list --team
task assign 1 @alice

# ヘルプ
task --help
task add --help
```

## 非機能要件

### パフォーマンス
- **コマンド実行時間**: 100ms以内(平均的なPC環境、タスク数1000件以下)
  - 測定方法: `time` コマンドで計測、CI/CDで継続的にモニタリング
- **タスク一覧表示**: 1000件のタスクでも1秒以内に表示完了
  - 測定方法: パフォーマンステストで1000件のダミーデータを作成して計測
- **起動時間**: 50ms以内(初回実行時は除く)
  - 測定方法: `time task --version` で計測

### ユーザビリティ
- **学習時間**: 新規ユーザーが5分以内に基本操作(add, list, start, done)を習得できる
  - 測定方法: ユーザビリティテスト(n=5以上)で操作完了までの時間を計測
- **ヘルプの充実度**: `task --help` で全機能を確認できる
  - 測定方法: ヘルプドキュメントのカバレッジが100%
- **エラーメッセージの明確さ**: エラー発生時、原因と解決策が明示される
  - 測定方法: エラーメッセージレビュー(開発者5人)で80%以上が「分かりやすい」と評価

### 信頼性
- **データ損失ゼロ**: タスクデータが失われない
  - 実装方法: ファイル書き込み前に自動バックアップを作成(`.task/tasks.json.bak`)
  - バックアップタイミング: タスクの追加・更新・削除のたびに、書き込み前に現在のファイルをバックアップ
  - バックアップ保持: 直前の1世代のみ保持(ディスク容量の節約)
- **エラーハンドリング**: すべてのエラーケースで適切なメッセージを表示し、安全に終了する
  - 測定方法: エラーケースのテストカバレッジが90%以上
- **ロールバック**: 危険な操作(delete, archiveなど)は取り消し可能
  - 実装方法: `task undo` コマンドで直前の操作を取り消せる(P1で実装)

### セキュリティ
- **GitHub認証**: Personal Access Tokenは暗号化して保存する
  - 実装方法: OS標準のキーチェーン(macOS Keychain, Windows Credential Manager, Linux Secret Service)を使用
  - フォールバック: キーチェーンが利用できない環境では、環境変数(`TASKCLI_GITHUB_TOKEN`)またはプレーンテキストファイル(`.task/config.json`)に保存し、警告を表示
- **プライバシー**: 匿名の利用統計はオプトイン方式で、タスクの内容は送信しない
  - 実装方法: 初回実行時に利用統計の送信可否を確認するプロンプトを表示
  - 収集するデータ: コマンド実行回数(コマンド名のみ)、OSバージョン、Node.jsバージョン、エラー発生頻度(エラーの種類のみ)
  - 収集しないデータ: タスクのタイトル、説明、ブランチ名、リポジトリ情報、個人を特定できる情報

### スケーラビリティ
- **タスク数**: 10,000件までのタスクを扱える
  - 測定方法: 10,000件のダミーデータで動作確認
- **リポジトリサイズ**: 大規模リポジトリ(Linuxカーネル級)でも正常動作する
  - 測定方法: 大規模リポジトリでのテスト

### クロスプラットフォーム対応
- **対応OS**: macOS、Linux、Windows(Git Bash)で動作する
  - 測定方法: 各OSでのE2Eテストが全てパス
- **Node.jsバージョン**: Node.js 18以上をサポート
  - 測定方法: CI/CDで複数バージョンでテスト

## スコープ外

明示的にスコープ外とする項目:
- **GUI版の提供**: CLIに特化し、GUI版は提供しない
- **モバイルアプリ**: スマートフォン向けアプリは提供しない
- **クラウド同期サービス**: 専用のクラウドサーバーは提供しない(GitHub経由の同期のみ)
- **GitLab/Bitbucketサポート**: MVPではGitHubのみサポート、他のプラットフォームは将来的に検討
- **プロジェクト管理機能**: ガントチャート、リソース管理などの高度なプロジェクト管理機能は提供しない
- **タイムトラッキング機能**: 作業時間の詳細な記録・分析機能はMVPでは提供しない(P2で基本機能のみ)
- **カスタムワークフロー**: タスクのステータスやワークフローのカスタマイズ機能はMVPでは提供しない

## 技術的制約

### データストレージ
- MVPではJSONファイル(`.task/tasks.json`)を使用
- 将来的にSQLiteへの移行を検討(タスク数が増えた場合)

### Git連携
- `simple-git` ライブラリを使用
- Gitリポジトリが存在しない場合はGit連携機能を無効化

### GitHub API
- GitHub REST API v3を使用
- Personal Access Tokenで認証
- レート制限を考慮した実装(キャッシュ、リトライロジック)

### CLIフレームワーク
- Commander.jsを使用(学習コストが低く、機能が十分)

### 依存関係
- Node.js 18以上を必須とする
- npmでの配布を想定(`npm install -g taskcli`)
