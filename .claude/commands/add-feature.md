---
description: 新機能を既存パターンに従って実装する
---

# 新機能の追加

引数: 機能名(例: `/add-feature ユーザープロフィール編集`)

## ステップ1: ステアリングディレクトリの作成

1. 現在の日付を取得(YYYYMMDDフォーマット)
2. `.steering/[日付]-[機能名]/`ディレクトリを作成
3. 以下の3つのファイルを作成:
   - `requirements.md`
   - `design.md`
   - `tasklist.md`

## ステップ2: プロジェクト理解

1. CLAUDE.mdを読む
2. `docs/`内の永続ドキュメントを確認

## ステップ3: 既存パターンの調査

Grepツールで類似機能を検索し、既存パターンを理解:

```bash
Grep('[機能に関連するキーワード]', 'src/')
```

## ステップ4: ステアリングファイルの作成

`Skill('steering')`を使用してステアリングファイルを作成してください。

## ステップ5: 実装

1. `Skill('steering')`を使用して実装を進めてください
2. 実装時は`Skill('development-guidelines')`のコーディング規約に従う

## ステップ5.5: tasklist.md完全完了チェック（必須）

**実装完了後、次のステップに進む前に必ず実行**:

1. **tasklist.mdを読み込む**
   ```bash
   Read('.steering/[日付]-[機能名]/tasklist.md')
   ```

2. **未完了タスク（`[ ]`）がないか確認**
   - 全てのタスクが`[x]`になっているか？
   - 1つでも`[ ]`が残っていないか？

3. **未完了タスクが見つかった場合**

   **❌ 絶対禁止の行為**:
   - 「時間の都合により別タスクとして実施予定」と記録して次に進む
   - 「実装が複雑すぎるため後回し」と記録して次に進む
   - 未完了タスクを無視して次のステップに進む

   **✅ 正しい対処法**:

   **パターンA: タスクを実装する（基本）**
   ```
   ステップ5に戻り、未完了タスクを実装する
   全タスク完了まで継続する
   ```

   **パターンB: タスクが大きすぎる場合**
   ```
   1. タスクを小さなサブタスクに分割
   2. tasklist.mdに分割したサブタスクを追加（Editツール使用）
   3. ステップ5に戻り、サブタスクを1つずつ完了させる
   ```

   **パターンC: 技術的な理由でタスクが不要になった場合のみ**

   以下の条件を満たす場合のみスキップ許可:
   - 実装方針の変更により、機能自体が不要になった
   - アーキテクチャ変更により、別の実装方法に置き換わった
   - 依存関係の変更により、タスクが実行不可能になった

   スキップ手順:
   ```
   1. tasklist.mdに技術的な理由を明記:
      「- [x] ~~タスク名~~（実装方針変更により不要: 具体的な技術的理由）」
   2. 振り返りセクションに変更理由を詳細に記録
   ```

4. **全タスク完了を確認**
   ```
   全てのタスクが`[x]`または技術的理由で`~~スキップ~~`になっていることを確認
   ステップ6へ進む
   ```

5. **未完了タスクがある場合の自動継続**
   ```
   未完了タスクが見つかった場合:
   → 自動的にステップ5に戻り、未完了タスクを実装
   → 全タスク完了まで継続
   ```

## ステップ6: 実装検証(サブエージェント起動)

implementation-validatorサブエージェントを起動して品質検証。

Task toolを使用してimplementation-validatorサブエージェントを起動してください:
- subagent_type: "implementation-validator"
- description: "Implementation quality validation"
- prompt: "[実装したファイルのパス]の品質を検証してください。コーディング規約、エラーハンドリング、テスト可能性、既存パターンとの整合性を確認してください。"

## ステップ7: テスト

```bash
Bash('npm test')
Bash('npm run lint')
Bash('npm run typecheck')
```

## ステップ8: ドキュメント更新(必要に応じて)

基本設計に影響する場合、永続ドキュメントを更新。

## 完了条件

- 全タスク完了
- サブエージェント検証パス
- テスト全てパス
- リント・型エラーなし
